On 9 January, 2018, when attempting to home the mono motors following the schduled power outage in December, the 2nd Xtal Roll motor moved to its negative limit, then reported an encoder loss. With Graeme Elliner's (FMB-O controls engineer) help, I came to resolution.&nbsp; Here are a couple of useful emails from Graeme to me from January 11 and 12, 2018.
<div style="background:#eee;  border:1px solid #ccc;  padding:5px 10px"><font size="2"><span style="font-size:10pt">Hi Bruce<br/><br/>We now need to work out where the problem is.<br/>NOTE you will not be able to drive anything while you're doing this or you potentially can break more.<br/>1: Unplug the Disable Plug from the back of the DCM (this will force all motors to be disabled) - itâ€™s the small black connector (bottom right as you look at the back)<br/>2: Disconnect PL102 & SK102 from IF2<br/>3: Disconnect PL103 & SK103 from IF3<br/>4: Connect PL103 & SK103 to IF2<br/>5: Connect PL102 & SK102 to IF3<br/><br/>IF the Red light on the Interpolator stayed with IF3 then there is a problem with Interpolator - Need to put motor into Open Loop<br/>IF the Red light on the Interpolator has moved to IF2 then the Interpolator is fine and it is cabling somewhere - GOTO STEP 6<br/><br/>6: SWAP PL102 and PL103<br/><br/>IF the red light has moved back to IF3 then the problem is between PL103 to the read head on the Xtal2 Roll stage - GOTO STEP 7<br/>IF the red light has stayed with IF2 then the problem is between SK103 to the MCS8<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This cabling is Pin to Pin so a simple continuity test on each pin should identify what has broken<br/><br/>7: SWAP SK102 and SK103<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The cabling should now be back to the original layout<br/>8: SWAP SK203-2 and SK203-3 at the feedthroughs on the DCM (FD3-2 & FD3-3 respectively)<br/><br/>IF the red light has moved to IF2 then the problem is INSIDE the DCM vessel - Need to put motor into Open Loop (and ultimately open the vessel to find it)<br/>If the red light has stayed on IF3 then there is a problem with the cable to the DCM<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This cable is should be Pin to Pin so a simple continuity test on each pin should identify what has broken<br/><br/><br/>To Put the Roll Axis into Open Loop<br/>Have you got PeWin working now??<br/>Using Pewin backup the config for the DCM and send it to me please.</span></font><br/><br/></div>
A lot of the cable swapping Graeme called for was to try to isolate a bad connection.&nbsp; The connection between read-head and motor controller is rather lengthy, with a vacuum feedthrough, a feedtrough on the side of the service box, and two connections to the interpolators inside the service box.

Following the steps laid out by Graeme, I isolated the problem to being inside the vacuum vessel.&nbsp; Drat! Using the [https://github.com/NSLS-II-BMM/BMM-beamline-configuration/blob/master/MCS8/mc02-11Jan2018.cfg old MC02 configuration] I saved to a file, Graeme made some edits as described below and sent me a [https://github.com/NSLS-II-BMM/BMM-beamline-configuration/blob/master/MCS8/mc02-12Jan2018.cfg new configuration file].
<div style="background:#eee;  border:1px solid #ccc;  padding:5px 10px"><font size="2"><span style="font-size:10pt">Hi Bruce<br/>I have modified the config file to now not use the encoder for position feedback. I have tested that it downloads with no errors<br/>Details of the mods are listed at the top of the file and below, I have marked all modifications with either GRE+ (for added code) or GRE- (for commented code)<br/><br/>In PLC1<br/>P446=0&nbsp; this disables encoder loss detection for axis4<br/><br/><br/>In the Ivars<br/>I430=700&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; changed to default stepper gain for no encoder<br/>I432=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; changed to default value for no encoder<br/>I7040=8 this forces the system to use steps for feedback<br/><br/>Use restore config from the backup menu in PEWin to install this<br/>CHECK that the box at the bottom reports NO ERRORS,<br/>in the terminal window you will need to "SAVE" and "$$$".<br/><br/>You will now find that the position scaling will be completely different now that you are not using the encoder. This means that your jog speeds will also be different<br/><br/>I strongly suggest NOT trying to use EPICS imediately.<br/><br/>Use the PeWin terminal (or the Jog Ribbon) to move axis 4 to the -ve limit ("#4j-") at the -ve limit type "#4HMZ" to zero the postion display and then to the +ve limit ("#4j+").<br/>This will tell you how many steps there are between the limits.<br/>Using this info and the data for the encoded version you should be able to move th axis to approximately the correct location.<br/><br/>I have noticed that in PLC14 (the homing PLC for axis 4) that even when the axis was using the encoder the home routine was not using the encoder home refernce.<br/>It is moving to the -ve limit then moving off 51926 encoder counts, then setting this to be HOME&nbsp; -&nbsp; search for GRE*** in the file.<br/><br/>This will not be correct now the system is using steps and might actually be more than you have measured as the range in steps.<br/>You will need to change this value before you can use EPICS to home the axis.<br/><br/>Once all this is working in PeWin you can test the homing routine by entering M1416=1 in the Pewin terminal.</span></font><br/><br/></div>
Following this set of instructions, I found that there are 1,218,299 steps between the two limits on the 2nd Xtal Roll motor.&nbsp; It would seem that there are about 10 or 12 steps per encoder count.&nbsp; The homing procedure works in the sense of finding the negative limit, then moving to a home position.&nbsp; But that home position seems to be about 1/10 of the way between the negative limit and the home-using-encoder-counts.